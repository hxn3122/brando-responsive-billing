<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>BRANDO • PDF Bill Generator</title>
<link href="https://unpkg.com/modern-css-reset/dist/reset.min.css" rel="stylesheet"/>
<style>
  .brand-centered{display:flex;justify-content:center;align-items:center;}
  .brand-centered h1{margin:0;color:#0B3D91;font-weight:800;letter-spacing:1px;}

    :root{
      --brand:#0B3D91;
      --brand-2:#1F6FEB;
      --bg:#f5f7fb;
      --card:#ffffff;
      --text:#0b0b0b;
      --muted:#6b7280;
      --line:#e5e7eb;
    }
    body{font-family: ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial; background:var(--bg); color:var(--text);}
    .wrap{max-width: 980px; margin: 32px auto; background:var(--card); padding:24px; border-radius:16px; box-shadow: 0 10px 30px rgba(0,0,0,.06);}
    .brand{display:flex; align-items:center; justify-content:space-between; gap:16px; margin-bottom:18px;}
    .brand .name{font-weight:900; font-size:28px; letter-spacing:.5px; color:var(--brand);}
    .nav{display:flex; gap:10px;}
    .nav a{padding:8px 12px; border-radius:10px; text-decoration:none; color:#fff; background:var(--brand-2); font-weight:600}
    h2{margin:18px 0 8px; font-size:18px;}
    table{width:100%; border-collapse: collapse; margin-top:10px;}
    th, td{padding:10px 8px; border-bottom: 1px solid var(--line);}
    th{background:var(--brand); color:#fff; text-align:left;}
    input[type="text"], input[type="number"], textarea{width:100%; padding:10px 12px; border:1px solid #ddd; border-radius:10px; outline:none}
    input[type="number"]{text-align:right;}
    textarea{min-height:70px; resize:vertical;}
    .grid{display:grid; grid-template-columns: 1fr 1fr; gap:12px;}
    @media (max-width: 640px){ .grid{grid-template-columns: 1fr;} .actions{flex-direction:column; align-items:stretch;} .total{text-align:left; margin-left:0;} }
    .actions{display:flex; gap:8px; margin-top:16px; align-items:center; flex-wrap: wrap;}
    button{padding:10px 14px; border:none; border-radius:12px; cursor:pointer; font-weight:700; background:var(--brand-2); color:#fff;}
    .add{background:#111; color:#fff;}
    .row-actions button{background:#f1f1f1; color:#111;}
    .total{font-weight:800; font-size: 18px; text-align:right; margin-top:10px; margin-left:auto}
    .flash{padding:10px 12px; border-radius:10px; margin-bottom:12px; background:#ffe7e7; color:#a40000; display:none;}
    .muted{color:var(--muted); font-size:12px;}
  </style>
<link href="/static/app.css" rel="stylesheet"/></head>
<body>
<div class="wrap">
<div class="brand">
<div class="name">BRANDO</div><div class="muted"></div>
<div class="nav">
<a href="/history">History</a> <a href="/admin/users">Admin</a> <a href="/logout" style="background:#c0392b">Logout</a>
</div>
</div>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
        <div class="flash" style="display:block">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <form action="/generate" id="bill-form" method="POST" target="_blank">
<h2>Customer Details</h2>
<div class="grid">
<div style="grid-column: span 2;">
<label class="muted">Customer Name</label>
<input name="customer_name" placeholder="e.g., Ahsan Ali" required="" type="text"/>
</div>
<div>
<label class="muted">Phone (Primary) — 11 digits required</label>
<input maxlength="11" minlength="11" name="phone_primary" pattern="^03[0-9]{9}$" placeholder="03XXXXXXXXX" required="" title="Phone must be exactly 11 digits e.g. 03XXXXXXXXX" type="text"/ inputmode="numeric" pattern="[0-9]{11}" maxlength="11">>
</div>
<div>
<label class="muted">Phone (Optional)</label>
<input maxlength="11" minlength="11" name="phone_secondary" pattern="^03[0-9]{9}$" placeholder="Optional extra number" title="Must be 11 digits e.g. 03XXXXXXXXX" type="text"/ inputmode="numeric" maxlength="11">>
</div>
<div>
<label class="muted">Invoice # (leave blank for auto)</label>
<input name="invoice_no" placeholder="auto" type="text"/ placeholder="auto">>
</div>
<div style="grid-column: span 2;">
<label class="muted">Customer Address</label>
<textarea name="customer_address" placeholder="Street, City"></textarea>
</div>
</div>
<h2>Items</h2>
<table id="items">
<thead>
<tr>
<th style="width:60%">Product Name</th>
<th style="width:25%; text-align:right">Price (PKR)</th>
<th style="width:15%">Actions</th>
</tr>
</thead>
<tbody>
<tr>
<td><input name="name[]" placeholder="e.g., Hot Wax Machine" required="" type="text"/></td>
<td><input min="0" name="price[]" placeholder="0.00" required="" step="0.01" type="number"/></td>
<td class="row-actions"><button onclick="removeRow(this)" type="button">Remove</button></td>
</tr>
</tbody>
</table>
<div class="actions">
<button class="add" onclick="addRow()" type="button">+ Add Item</button>
<button type="submit">Preview / Print PDF</button>
<button formaction="/generate?share=1" formtarget="_blank" title="Generate and open Share dialog" type="submit">Share to WhatsApp</button>
<div class="total">Total: <span id="total">PKR 0.00</span></div>
</div>
</form>
<p class="muted">After the PDF opens, press <b>Ctrl + P</b> to print or save as PDF.</p>
</div>
<script>
    function addRow(){
      const tbody = document.querySelector("#items tbody");
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td><input name="name[]" type="text" placeholder="Product name" required/></td>
        <td><input name="price[]" type="number" step="0.01" min="0" placeholder="0.00" required/></td>
        <td class="row-actions"><button type="button" onclick="removeRow(this)">Remove</button></td>
      `;
      tbody.appendChild(tr);
      attachChangeHandlers(tr);
      updateTotal();
    }
    function removeRow(btn){
      const tr = btn.closest("tr");
      tr.parentNode.removeChild(tr);
      updateTotal();
    }
    function updateTotal(){
      const prices = document.querySelectorAll('input[name="price[]"]');
      let sum = 0;
      prices.forEach(inp => {
        const v = parseFloat(inp.value);
        if(!isNaN(v)) sum += v;
      });
      document.getElementById("total").textContent = "PKR " + (Math.round(sum*100)/100).toFixed(2);
    }
    function attachChangeHandlers(root){
      root.querySelectorAll('input[name="price[]"]').forEach(inp=>{
        inp.addEventListener('input', updateTotal);
      });
    }
    document.querySelectorAll('tbody tr').forEach(attachChangeHandlers);
    updateTotal();
  </script>
</body>
</html>